# Google スプレッドシート連携 セットアップガイド

## 概要
このガイドでは、フォームデータを自動的にGoogleスプレッドシートに保存する方法を説明します。

## セットアップ手順

### 1. Googleスプレッドシートの準備

1. [Google Sheets](https://sheets.google.com)で新しいスプレッドシートを作成
2. シート名を「フォーム回答」に変更（シートタブを右クリック → 名前を変更）

### 2. Google Apps Scriptの設定

1. **拡張機能 → Apps Script** を選択
2. 開いたエディタで、既存のコードをすべて削除
3. `google-apps-script.gs`の内容をコピーして貼り付け
4. `保存`ボタンをクリック（プロジェクト名を聞かれたら「フォーム連携」など適当な名前を付ける）

### 3. ウェブアプリとしてデプロイ

1. **デプロイ → 新しいデプロイ** をクリック
2. 種類の選択で歯車アイコン → **ウェブアプリ** を選択
3. 以下の設定を行う：
   - **説明**: フォームデータ受信
   - **次のユーザーとして実行**: 自分
   - **アクセスできるユーザー**: 全員
4. **デプロイ** ボタンをクリック
5. 初回は権限の承認が必要：
   - 「アクセスを承認」をクリック
   - Googleアカウントを選択
   - 「詳細」をクリック → 「安全ではないページに移動」をクリック
   - 「許可」をクリック
6. 表示された**ウェブアプリのURL**をコピー

### 4. フォームの設定

1. `public/google-sheets-connector.js`を開く
2. 3行目の`scriptUrl`を、コピーしたURLに置き換える：

```javascript
config: {
    scriptUrl: 'https://script.google.com/macros/s/ここにあなたのスクリプトIDが入ります/exec',
    sheetName: 'フォーム回答'
}
```

### 5. 動作確認

1. フォームに入力して送信
2. Googleスプレッドシートに自動的にデータが追加されることを確認

## フォームデータの内容

以下のデータが自動的に保存されます：

| カラム名 | 内容 |
|---------|------|
| タイムスタンプ | 送信日時 |
| 性別 | 男性/女性 |
| 姓・名 | お名前 |
| 姓・名（カナ） | フリガナ |
| 生年月日 | 生年月日 |
| 身長・体重 | 身体情報 |
| 連絡先 | メール、電話番号 |
| 住所 | 郵便番号、都道府県、市区町村、住所 |
| ライフスタイル | 働き方、ビジネスシーン、プライベートシーン |
| ファッション情報 | スタイル、ブランド好み、避けたいアイテム |
| サービス要望 | アプリ利用、配送など |
| その他 | コメント |

## トラブルシューティング

### 「スクリプトを実行する権限がありません」エラー

1. Apps Scriptエディタで、**実行** ボタンをクリック
2. 権限の承認を行う
3. 再度デプロイを行う

### データが保存されない

1. ブラウザの開発者コンソールでエラーを確認
2. Apps Scriptのログを確認：
   - Apps Scriptエディタで **実行数** をクリック
   - エラーログを確認

### CORS エラー

これは正常な動作です。Google Apps Scriptは`no-cors`モードで動作するため、レスポンスは受け取れませんが、データは正常に保存されます。

## カスタマイズ

### 列の追加

1. `form-data-exporter.js`の`collectFormData`関数に新しいフィールドを追加
2. `google-apps-script.gs`の`setupHeaders`関数にヘッダーを追加
3. 再度デプロイ

### 自動バックアップ

Google Apps Scriptエディタで：
1. **トリガー** をクリック
2. **トリガーを追加**
3. 関数：`backupData`、イベント：時間主導型、頻度：毎日
4. 保存

## セキュリティ

- ウェブアプリのURLは秘密にしてください
- 不要になったら、デプロイを無効化してください
- 定期的にアクセスログを確認してください

## サンプルデータ

`sample-form-data.csv`にサンプルデータが含まれています。
これをGoogleスプレッドシートにインポートして、データ形式を確認できます。