<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Style Selection Test</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        h2 {
            margin-top: 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #0056b3;
        }
        .output {
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Style Selection Test</h1>

    <div class="test-section">
        <h2>Test 1: Check Pattern Selection Elements</h2>
        <button onclick="checkPatternElements()">Check Elements</button>
        <div id="elements-output" class="output"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Simulate Style Selection</h2>
        <button onclick="simulateStyleSelection()">Select Mode Style</button>
        <button onclick="clearStyleSelection()">Clear Selection</button>
        <div id="simulation-output" class="output"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Check JavaScript Functions</h2>
        <button onclick="checkFunctions()">Check Functions</button>
        <div id="functions-output" class="output"></div>
    </div>

    <script>
        function checkPatternElements() {
            const output = document.getElementById('elements-output');
            const elements = {
                'Pattern Section': document.getElementById('patternSelections'),
                'Pattern Container': document.getElementById('patternSelectionsContainer'),
                'Style Checkboxes': document.querySelectorAll('input[name="attractiveStyle"]'),
                'Mode Checkbox': document.getElementById('attractive-mode')
            };

            let result = 'Checking elements:\n\n';
            for (const [name, element] of Object.entries(elements)) {
                if (element instanceof NodeList) {
                    result += `${name}: ${element.length} found\n`;
                } else {
                    result += `${name}: ${element ? 'Found' : 'NOT FOUND'}\n`;
                }
            }
            output.textContent = result;
        }

        function simulateStyleSelection() {
            const output = document.getElementById('simulation-output');
            const modeCheckbox = document.getElementById('attractive-mode');
            
            if (!modeCheckbox) {
                output.textContent = 'Mode checkbox not found!';
                return;
            }

            // Simulate checking the mode checkbox
            modeCheckbox.checked = true;
            modeCheckbox.dispatchEvent(new Event('change', { bubbles: true }));

            setTimeout(() => {
                const patternSection = document.getElementById('patternSelections');
                const container = document.getElementById('patternSelectionsContainer');
                
                let result = 'After selection:\n\n';
                result += `Pattern section visible: ${patternSection && patternSection.style.display !== 'none'}\n`;
                result += `Container has content: ${container && container.innerHTML.trim().length > 0}\n`;
                
                if (container && container.innerHTML.trim().length > 0) {
                    const patterns = container.querySelectorAll('.pattern-variation-card');
                    const items = container.querySelectorAll('.pattern-good-bad-item');
                    result += `Pattern variations found: ${patterns.length}\n`;
                    result += `Item evaluations found: ${items.length}\n`;
                }
                
                output.textContent = result;
            }, 100);
        }

        function clearStyleSelection() {
            const checkboxes = document.querySelectorAll('input[name="attractiveStyle"]');
            checkboxes.forEach(cb => cb.checked = false);
            const event = new Event('change', { bubbles: true });
            if (checkboxes.length > 0) {
                checkboxes[0].dispatchEvent(event);
            }
            document.getElementById('simulation-output').textContent = 'Selection cleared';
        }

        function checkFunctions() {
            const output = document.getElementById('functions-output');
            const functions = [
                'initializePatternSelection',
                'updatePatternSelections',
                'renderPatternSelections'
            ];

            let result = 'Checking functions:\n\n';
            for (const func of functions) {
                result += `${func}: ${typeof window[func] === 'function' ? 'Defined' : 'NOT DEFINED'}\n`;
            }
            output.textContent = result;
        }

        // Load the form page in an iframe for testing
        window.onload = function() {
            const iframe = document.createElement('iframe');
            iframe.src = 'index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                // Copy elements from iframe to main document for testing
                const iframeDoc = iframe.contentDocument;
                
                // Clone the necessary elements
                const elements = [
                    '#patternSelections',
                    '#patternSelectionsContainer',
                    '#attractive-mode',
                    '[name="attractiveStyle"]'
                ];
                
                elements.forEach(selector => {
                    const el = iframeDoc.querySelector(selector);
                    if (el && !document.querySelector(selector)) {
                        document.body.appendChild(el.cloneNode(true));
                    }
                });
                
                // Check if functions are available in iframe
                if (iframe.contentWindow.initializePatternSelection) {
                    window.initializePatternSelection = iframe.contentWindow.initializePatternSelection;
                    window.updatePatternSelections = iframe.contentWindow.updatePatternSelections;
                    window.renderPatternSelections = iframe.contentWindow.renderPatternSelections;
                }
            };
        };
    </script>
</body>
</html>